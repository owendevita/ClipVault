<!DOCTYPE html>
<html lang="en">
    <head>
        <title>ClipVault</title>
        <link rel="stylesheet" href="style_main.css">
    </head>
    <body>
        <div class="header">
            <div class="header-content">
                <img src="./logo.png" alt="ClipVault Logo" class="logo">
                <div class="header-name">
                    <p>ClipVault</p>
                </div>
            </div>
        </div>

        <!-- Add connection status display -->
        <div id="connection-status" class="status-container"></div>
        
        <!-- User info display -->
        <div class="user-info">
            <p id="current-user">Loading user info...</p>
        </div>

        <div class="button-container">
            <button class="history-btn" onclick="window.location.href='history.html'">Clipboard History</button>
            <button class="preferences-btn" onclick="window.location.href='preferences.html'">User Preferences</button>
            <button class="logout-btn" onclick="logout()">Log out</button>
        </div>

        <script>
            // Check authentication and load user info
            window.onload = async () => {
                // Check if user is authenticated
                if (!window.backend.auth.isLoggedIn()) {
                    window.location.href = 'login.html';
                    return;
                }

                // Display user info
                const username = window.backend.auth.getUsername();
                document.getElementById('current-user').textContent = `Welcome, ${username}!`;

                // Test backend connection and show security status
                try {
                    const result = await window.backend.testConnection();
                    const statusElement = document.getElementById('connection-status');
                    
                    if (result.status === 'ok') {
                        statusElement.innerHTML = `
                            <div class="status-ok">
                                <strong>üîí ClipVault Secure</strong><br>
                                Backend: Connected<br>
                                Encryption: ${result.security?.encryption_working ? '‚úÖ Active' : '‚ùå Error'}<br>
                                Keys: ${result.security?.keys_available ? '‚úÖ Available' : '‚ùå Missing'}
                            </div>
                        `;
                        statusElement.style.color = '#28a745';
                    } else {
                        statusElement.innerHTML = `<div class="status-error">‚ùå Backend Error</div>`;
                        statusElement.style.color = '#dc3545';
                    }
                } catch (error) {
                    console.error('Connection test failed:', error);
                    document.getElementById('connection-status').innerHTML = `
                        <div class="status-error">‚ùå Could not connect to backend</div>
                    `;
                    document.getElementById('connection-status').style.color = '#dc3545';
                }
            }

            // Secure logout function
            function logout() {
                if (confirm('Are you sure you want to log out?')) {
                    window.backend.auth.logout();
                }
            }

            // Exit the application
            function exitApp() {
                if (window.backend && window.backend.exitApp) {
                    window.backend.exitApp();
                } else {
                    window.close();
                }
            }
        </script>

         <script src="renderer.js"></script>
    </body>
</html>